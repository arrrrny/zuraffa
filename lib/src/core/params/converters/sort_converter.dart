import 'package:zorphy_annotation/zorphy_annotation.dart';

/// Converter for [Sort] type.
///
/// Provides static methods for serializing and deserializing Zorphy Sort objects.
///
/// The converter works with [Sort<dynamic>] to avoid generic type constraints
/// that json_serializable cannot handle directly.
///
/// ## Serialization
/// Sorts are serialized using their built-in `toJson()` method, which is
/// automatically generated by the Zorphy code generator.
///
/// ## Deserialization
/// Deserialization creates a generic [Field] object without a `getValue` function.
/// For full deserialization support, consider implementing entity-specific deserializers.
///
/// ## Example
/// ```dart
/// // Serialization
/// final sort = Sort(User.name, descending: true);
/// final json = SortConverter.toJson(sort);
/// // json: {'field': 'name', 'descending': true}
///
/// // Deserialization
/// final decoded = SortConverter.fromJson({'field': 'name', 'descending': true});
/// // decoded: Sort(Field('name', null), descending: true)
/// ```
class SortConverter {
  SortConverter._();

  /// Serializes a [Sort] to JSON.
  ///
  /// Uses Sort's built-in `toJson` method, which is provided by
  /// zorphy code generation.
  static Map<String, dynamic>? toJson(Sort<dynamic>? sort) {
    if (sort == null) return null;
    return sort.toJson();
  }

  /// Deserializes a [Sort] from JSON.
  ///
  /// Creates a generic [Field] object without a `getValue` function.
  /// For proper matching operations, implement entity-specific deserializers.
  static Sort<dynamic>? fromJson(Map<String, dynamic>? json) {
    if (json == null) return null;
    final fieldName = json['field'] as String?;
    if (fieldName == null) return null;
    final field = Field<dynamic, dynamic>(fieldName, null);
    final descending = json['descending'] as bool? ?? false;
    return Sort(field, descending: descending);
  }
}
